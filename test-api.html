<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test API</title>
</head>

<body>
  <p id="message"></p>
  <input type="text" id="name">
  <input type="number" id="groesse">
  <input type="date" id="date"><br>
  <button id="add">insert</button><br>

  <input type="number" id="id"><br>
  <button id="get">find</button>
  <button id="del">delete</button>
  <button id="update">update</button>

<template>
  <tr>
    <td id="tab-id">
    <td id="tab-name">
    <td id="tab-groesse">
    <td id="tab-date">
  </tr>
</template>
</body>
<script>
  document.addEventListener('DOMContentLoaded', e => {
    const id = document.getElementById('id');
    let message = document.getElementById('message');"";

    // (async () => {
    //   const response = await fetch('/test');
    //   const data = await response.json();
    // })();

    document.getElementById('get').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, { method: 'GET'} );
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${id.value} `;
        document.getElementById('name').value = result.Name;
        document.getElementById('groesse').value = result.groesse;
        document.getElementById('date').value = result.Date;

      } else {
        message.textContent = `Error: ${response.statusText}`;
      }
    });

    document.getElementById('add').addEventListener('click', async ev => {
      const response = await fetch(`/test`, {
        method: 'POST',
        body: JSON.stringify({
          Name: document.getElementById('name').value,
          groesse: parseFloat(document.getElementById('groese').value),
          Date: document.getElementById('date').value
        })
      });
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} `;
        id.value = result.id;
      } else {
        message.textContent = `Error: ${response.statusText}`;
      }
    });

    document.getElementById('update').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, {
        method: 'PUT',
        body: JSON.stringify({
          Name: document.getElementById('name').value,
          groesse: parseFloat(document.getElementById('groesse').value),
          Date: document.getElementById('date').value
        })
      });

      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} ${result.result}`;
      } else {
        message.textContent = `Error: ${response.status}`;
      }
    });

    document.getElementById('del').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, { method: 'DELETE' });
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} ${result.result}`;
      } else {
        message.textContent = `Error: ${response.status}`;
      }
    });

  })

</script>

</html>