<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="./assets/js/main.js"></script>
  <title>Test API</title>
</head>

<body>
  <p id="message"></p>
  <input type="text" id="name">
  <input type="number" id="groesse">
  <input type="date" id="date"><br>
  <button id="add">insert</button><br>

  <input type="number" id="id"><br>
  <button id="get">find</button>
  <button id="del">delete</button>
  <button id="update">update</button>

<template>
  <tr>
    <td id="tab-id">
    <td id="tab-name">
    <td id="tab-groesse">
    <td id="tab-date">
  </tr>
</template>
</body>
<script>
  document.addEventListener('DOMContentLoaded', e => {
    const id = $('#id');
    let message = $('#message');"";

    $('#get').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, { method: 'GET'} );
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${id.value} `;
        $('#name').value = result.Name;
        $('#groesse').value = result.groesse;
        $('#date').value = result.Date;

      } else {
        message.textContent = `Error: ${response.statusText}`;
      }
    });

    $('#add').addEventListener('click', async ev => {
      const response = await fetch(`/test`, {
        method: 'POST',
        body: JSON.stringify({
          Name: $('#name').value,
          groesse: parseFloat($('#groesse').value),
          Date: $('#date').value
        })
      });
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} `;
        id.value = result.id;
      } else {
        message.textContent = `Error: ${response.statusText}`;
      }
    });

    $('#update').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, {
        method: 'PUT',
        body: JSON.stringify({
          Name: $('#name').value,
          groesse: parseFloat($('#groesse').value),
          Date: $('#date').value
        })
      });

      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} ${result.result}`;
      } else {
        message.textContent = `Error: ${response.status}`;
      }
    });

    $('#del').addEventListener('click', async ev => {
      const response = await fetch(`/test/${id.value}`, { method: 'DELETE' });
      if (!response.ok) {
        message.textContent = `Error: ${response.status}`;
      } else if (200 <= response.status && response.status <= 299) {
        //success
        result = await response.json();
        message.textContent = `${response.statusText} ${result.id} ${result.result}`;
      } else {
        message.textContent = `Error: ${response.status}`;
      }
    });

  })

</script>

</html>